trigger:
- main

pool:
  vmImage: 'ubuntu-latest'

variables:
  FRONT_URL: 'http://localhost:4200'

steps:
# 1. Instalar Node.js
- task: NodeTool@0
  inputs:
    versionSpec: '20.x'
  displayName: 'Instalar Node.js'

# 2. Instalar dependencias
- script: |
    npm install --legacy-peer-deps
  displayName: 'Instalar dependencias'

# 3. Levantar frontend Angular en background
- script: |
    npx ng serve --port 4200 &
    echo "Esperando a que Angular est√© listo..."
    sleep 20
  displayName: 'Levantar frontend Angular'

# 4. Instalar navegadores de Playwright
- script: |
    npx playwright install
  displayName: 'Instalar navegadores de Playwright'

# 5. Ejecutar tests de Playwright
- script: |
    npx playwright test ./playwright/tests --timeout 60000
  displayName: 'Ejecutar tests de Playwright'
