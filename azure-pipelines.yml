trigger:
  - main  # o la rama que prefieras

pool:
  vmImage: 'ubuntu-latest'

variables:
  node_version: '20.x'  # versión de Node.js

steps:
  # 1️⃣ Instalar Node.js
  - task: UseNode@1
    inputs:
      version: $(node_version)

  # 2️⃣ Instalar dependencias del proyecto Angular
  - script: |
      npm ci
    displayName: 'Instalar dependencias del proyecto'

  # 3️⃣ Compilar la app Angular (si aplica)
  - script: |
      npm run build --if-present
    displayName: 'Compilar aplicación Angular'

  # 4️⃣ Instalar Playwright (en la carpeta playwright/)
  - script: |
      cd playwright
      npm ci
      npx playwright install --with-deps
    displayName: 'Instalar dependencias y navegadores de Playwright'

  # 5️⃣ Ejecutar tests de Playwright
  - script: |
      cd playwright
      npx playwright test --reporter=html
    displayName: 'Ejecutar tests E2E con Playwright'

  # 6️⃣ Publicar reporte de Playwright
  - task: PublishPipelineArtifact@1
    inputs:
      targetPath: 'playwright/playwright-report'
      artifact: 'playwright-report'
    condition: succeededOrFailed()
    displayName: 'Publicar reporte HTML de Playwright'
