trigger:
- main

pool:
  vmImage: 'ubuntu-latest'

steps:
# 1. Checkout del repositorio
- task: Checkout@1

# 2. Instalar Node.js
- task: UseNode@1
  inputs:
    version: '20.x'

# 3. Instalar dependencias del proyecto
- script: |
    npm ci --legacy-peer-deps
  displayName: 'Instalar dependencias'

# 4. Levantar frontend Angular en background
- script: |
    npx ng serve --port 4200 --host 0.0.0.0 &
    echo "Esperando 10 segundos para que Angular arranque..."
    sleep 10
  displayName: 'Levantar frontend Angular'

# 5. Instalar browsers de Playwright
- script: |
    npx playwright install
  displayName: 'Instalar navegadores Playwright'

# 6. Ejecutar tests de Playwright
- script: |
    npx playwright test ./playwright/tests --timeout 60000
  displayName: 'Ejecutar tests de Playwright'
